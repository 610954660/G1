--Name : RunePreView.lua
--Author : generated by FairyGUI
--Date : 2020-7-27
--Desc : 
local RuneConfiger = require "Game.Modules.RuneSystem.RuneConfiger"
local RunePreView,Super = class("RunePreView", Window)
local colorArr = {100,3,1,2}
function RunePreView:ctor()
	--LuaLog("RunePreView ctor")
	self._packName = "RuneSystem"
	self._compName = "RunePreView"
	self._rootDepth = LayerDepth.PopWindow
	self.config = false
end

function RunePreView:_initEvent( )
	
end

function RunePreView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:RuneSystem.RunePreView
		vmRoot.prosList = viewNode:getChildAutoType("$prosList")--list
	--{vmFieldsEnd}:RuneSystem.RunePreView
	--Do not modify above code-------------
	vmRoot.leftList = viewNode:getChildAutoType("$leftList")
	vmRoot.rightList = viewNode:getChildAutoType("$rightList")
end


function RunePreView:_initUI( )
	self:_initVM()
	self.rightList:setItemRenderer(function (index,obj)
		local title = obj:getChildAutoType("title")
		local value = obj:getChildAutoType("value")
		local txtPoint = obj:getChildAutoType("txtPoint")
		local typeCtrl = obj:getController("typeCtrl")
		title:setText(Desc["common_fightAttr"..self.config[index+1].attribute[1]])
		if self.config[index+1].attribute[2]<=100 then
			typeCtrl:setSelectedIndex(0)
			value:setText("+"..(self.config[index+1].attribute[2]/100).."%")
		else
			typeCtrl:setSelectedIndex(1)
			value:setText("+"..self.config[index+1].attribute[2])
		end
		
		if self.config[index+1].attribute[1] < 100 or RuneConfiger.isHightAttr(self.config[index+1].attribute[1]) then
			title:setColor(ColorUtil.textColor.yellow)
			value:setColor(ColorUtil.textColor.yellow)
			txtPoint:setColor(ColorUtil.textColor.yellow)
		else
			title:setColor(ColorUtil.textColor.black)
			value:setColor(ColorUtil.textColor.black)
		end
	end)
    self.leftList:addEventListener(FUIEventType.ClickItem,function()
		local index = self.leftList:getSelectedIndex()+1
		self:changeSelect(index)
	end)
	self.leftList:setSelectedIndex(0)
	self:changeSelect(1)
end

function RunePreView:changeSelect(index)
	local color = colorArr[index]
	local config = RuneConfiger.getRuneArrConfig(color)
	TableUtil.sort(config, function(a,b)
		local idA = a.attribute[1] 
		local idB = b.attribute[1] 
		local highA = (idA < 100 or RuneConfiger.isHightAttr(idA)) and 1 or 0
		local highB = (idB < 100 or RuneConfiger.isHightAttr(idB)) and 1 or 0
		return highA > highB
	
	end)
	self.config = config
	self.rightList:setData(self.config)
end




return RunePreView