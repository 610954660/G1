--Name : RuneHeroDemountView.lua
--Author : generated by FairyGUI
--Date : 2020-7-27
--Desc : 

local RuneHeroDemountView,Super = class("RuneHeroDemountView", Window)
local  RuneConfiger = require "Game.Modules.RuneSystem.RuneConfiger"
function RuneHeroDemountView:ctor()
	--LuaLog("RuneHeroDemountView ctor")
	self._packName = "RuneSystem"
	self._compName = "RuneHeroDemountView"
	self._rootDepth = LayerDepth.PopWindow
	self.pos = self._args.pos
	
end

function RuneHeroDemountView:_initEvent( )
	self.confirmBtn:addClickListener(function( ... )
		local params = {}
        params.id = RuneSystemModel:getCurBjRuneID()
        params.pos = self.pos
        params.onSuccess = function (res )
            printTable(1,"下阵英雄服务器数据",res)
            local data = {}
            -- if tonumber(res.id) == tonumber(RuneSystemModel:getCurBjRuneID()) then
            	data.cd = res.cd
			    data.pos = self.pos
			    data.uuid = ""
			    RuneSystemModel:setCurRuneEquipHero( data )
			    Dispatcher.dispatchEvent("update_rune_heroList")
			    ViewManager.close("RuneHeroDemountView")
            -- else
            -- 	RollTips.show("符文页不对应 错误")
            -- end
        end
        RPCReq.Rune_TakeEquipHero(params, params.onSuccess)
	end)
	self.btn_cancel:addClickListener(function( ... )
		ViewManager.close("RuneHeroDemountView")
	end)
end

function RuneHeroDemountView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:RuneSystem.RuneHeroDemountView
		vmRoot.timeLab = viewNode:getChildAutoType("$timeLab")--text
		vmRoot.title = viewNode:getChildAutoType("$title")--richtext
		vmRoot.confirmBtn = viewNode:getChildAutoType("$confirmBtn")--Button
		vmRoot.cardItem = viewNode:getChildAutoType("$cardItem")--Button
		vmRoot.btn_cancel = viewNode:getChildAutoType("$btn_cancel")--Button
	--{vmFieldsEnd}:RuneSystem.RuneHeroDemountView
	--Do not modify above code-------------
end

function RuneHeroDemountView:_initUI( )
	self:_initVM()
    self:updatePanel()
end

--更新页面窗口
function RuneHeroDemountView:updatePanel( ... )
	local heroItem = BindManager.bindCardCell(self.cardItem);
	local data = RuneSystemModel:getEquipHeroByPos( self.pos )
	local cardData = CardLibModel:getHeroByUid(data.uuid)
	heroItem:setData(cardData,true)
	local name = cardData.heroDataConfiger.heroName
	local level = cardData.level
	-- self.title:setText("请问确认卸下"..name.."("..level.."级)".."吗？")
	local Allconfig = RuneConfiger.getRunePalace( ... )
    local config = Allconfig[self.pos]
    self.timeLab:setText(TimeLib.formatTime(config.retime))
end



return RuneHeroDemountView