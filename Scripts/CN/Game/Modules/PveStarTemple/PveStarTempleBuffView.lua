--Name : PveStarTempleBuffView.lua
--Author : generated by FairyGUI
--Date : 2020-7-29
--Desc : 

local PveStarTempleBuffView,Super = class("PveStarTempleBuffView", Window)

function PveStarTempleBuffView:ctor()
	--LuaLog("PveStarTempleBuffView ctor")
	self._packName = "PveStarTemple"
	self._compName = "PveStarTempleBuffView"
	self._rootDepth = LayerDepth.PopWindow
	self.buffData = {}
end

function PveStarTempleBuffView:_initEvent( )
	
end

function PveStarTempleBuffView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:PveStarTemple.PveStarTempleBuffView
		--{vmFieldsEnd}:PveStarTemple.PveStarTempleBuffView
	--Do not modify above code-------------
end

function PveStarTempleBuffView:_initUI( )
	self:_initVM()
	self.buffList = self.view:getChildAutoType("buffList")
	self.currBuff = self.view:getChildAutoType("currBuff")
	self.buffList:setItemRenderer(function(index,obj)
		self:buffListRenderer(index,obj)
	end)

	self:updateBuffList()
	self:updateCurrBuff()
end

function PveStarTempleBuffView:updateCurrBuff()
	local round = ModelManager.PveStarTempleModel:getRoundNumber()
	local buff = DynamicConfigData.t_PveStarTempleRoundConfig[round].buffId[1]
	local buffConfig = DynamicConfigData.t_combat[buff.code]
	local symbol = buff.value >= 0 and "提升" or ""
	self.currBuff:getChildAutoType("txtName"):setText(buffConfig.name)
	self.currBuff:getChildAutoType("txtDesc"):setText(string.format("%s%s%%",symbol,buff.value/100))
end

function PveStarTempleBuffView:updateBuffList()
	self.buffData = ModelManager.PveStarTempleModel:getAttrList()
	self.buffList:setNumItems(#self.buffData)
end

function PveStarTempleBuffView:buffListRenderer(index,obj)
	local buffInfo = self.buffData[index + 1]
	local buffConfig = DynamicConfigData.t_combat[buffInfo.id]
	local symbol = buffInfo.value >= 0 and "+" or ""
	local txtName = obj:getChildAutoType("txtName")
	local txtDesc =  obj:getChildAutoType("txtDesc")

	txtName:setText(buffConfig.name)
	txtDesc:setText(string.format("%s%s%%",symbol,buffInfo.value/100))
	obj:getController("showBG"):setSelectedIndex(2)
end

return PveStarTempleBuffView