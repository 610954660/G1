--Name : PveStarTempleNpcView.lua
--Author : generated by FairyGUI
--Date : 2020-7-31
--Desc : 

local PveStarTempleNpcView,Super = class("PveStarTempleNpcView", Window)

function PveStarTempleNpcView:ctor()
	--LuaLog("PveStarTempleNpcView ctor")
	self._packName = "PveStarTemple"
	self._compName = "PveStarTempleNpcView"
	self._rootDepth = LayerDepth.PopWindow
	self.areaID = self._args.areaID
	self.pos = self._args.pos
	self.eventID = self._args.eventID
	self.configData = ModelManager.PveStarTempleModel:getEventConfig(5,0,self.eventID)
	self.optionDataList = {}
	self.resultDataList = {}
end

function PveStarTempleNpcView:_initEvent( )
	
end

function PveStarTempleNpcView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:PveStarTemple.PveStarTempleNpcView
		--{vmFieldsEnd}:PveStarTemple.PveStarTempleNpcView
	--Do not modify above code-------------
end

function PveStarTempleNpcView:_initUI( )
	self:_initVM()
	self.txtDesc = self.view:getChildAutoType("txtDesc")
	self.optionList = self.view:getChildAutoType("optionList")

	self.optionList:setItemRenderer(function(index,obj)
		self:optionListRenderer(index,obj)
	end)

	self:updateView()
	self:updateOptionList()
end

function PveStarTempleNpcView:_exit()
	self.areaID = false
	self.pos = false
	self.eventID = false
	self.optionDataList = false
	self.resultDataList = false
	self.configData = false
end

function PveStarTempleNpcView:updateView()
	self.txtDesc:setText(self.configData.dec)
	self._frame:setTitle(self.configData.title)
end

function PveStarTempleNpcView:updateOptionList()
	self.optionDataList = {}
	self.resultDataList = {}

	for word in string.gmatch(self.configData.option,'%[([^%[%]]+)%]') do
		table.insert(self.optionDataList,word)
	end

	for word in string.gmatch(self.configData.result,'%[([^%[%]]+)%]') do
		table.insert(self.resultDataList,word)
	end

	self.optionList:setNumItems(#self.optionDataList)
	self.optionList:resizeToFit(#self.optionDataList)
end

function PveStarTempleNpcView:optionListRenderer(index,obj)
	local optionStr = self.optionDataList[index + 1]
	obj:setTitle(optionStr)
	obj:addClickListener(function()
		self:onOptionClick(index + 1)
	end)
end

function PveStarTempleNpcView:onOptionClick(index)
	RollTips.show(self.resultDataList[index])
	Dispatcher.dispatchEvent(EventType.PveStarTemple_EevntUse,{areaID = self.areaID,pos = self.pos})
	self:closeView()
end


return PveStarTempleNpcView