--Name : DutyWatchView.lua
--Author : generated by FairyGUI
--Date : 2020-6-13
--Desc : 职级预览  added by xhd

local DutyWatchView,Super = class("DutyWatchView", Window)
function DutyWatchView:ctor()
	--LuaLog("DutyWatchView ctor")
	self._packName = "Duty"
	self._compName = "DutyWatchView"
	self.allConfig = false
	--self._rootDepth = LayerDepth.Window
	
end

function DutyWatchView:_initEvent( )
	
end

function DutyWatchView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:Duty.DutyWatchView
		vmRoot.list = viewNode:getChildAutoType("$list")--list
	--{vmFieldsEnd}:Duty.DutyWatchView
	--Do not modify above code-------------
end

function DutyWatchView:_initUI( )
	self:_initVM()
	self:setBg("bg_generalA.jpg")
	self.list:setItemRenderer(function (index,obj)
		local hadGetCtrl = obj:getController("hadGetCtrl")
		local showCtrl = obj:getController("showCtrl")
		local proList = obj:getChildAutoType("proList")
		local itemList = obj:getChildAutoType("itemList")
		local dutyName = obj:getChildAutoType("dutyName")
		local icon = obj:getChildAutoType("icon")
		local curDutyIndex = DutyModel:getCurDutyIndex()
		local tempIndex = index + 1 
		local config = self.allConfig[tempIndex]
		dutyName:setText(config.dutyName)
		hadGetCtrl:setSelectedIndex(0)
		if tempIndex <= 1 then
			hadGetCtrl:setSelectedIndex(0)
			showCtrl:setSelectedIndex(1)
		elseif curDutyIndex>= tempIndex then
			hadGetCtrl:setSelectedIndex(1)
			showCtrl:setSelectedIndex(1)
			-- if curDutyIndex == tempIndex then
			-- 	hadGetCtrl:setSelectedIndex(1)
			-- else
			-- 	hadGetCtrl:setSelectedIndex(0)
			-- end
		else
			hadGetCtrl:setSelectedIndex(0)
			if curDutyIndex+1 == tempIndex then
				showCtrl:setSelectedIndex(1)
			else
				showCtrl:setSelectedIndex(0)
				dutyName:setText("? ? ?")
			end
		end
		icon:setURL(PathConfiger.getDutyIcon(tempIndex))
		
		local proData = {}
	    proData[1] = {}
	    proData[1].name = Desc.common_fightAttr1
	    proData[1].value = config.hp
	    proData[2] = {}
	    proData[2].name = Desc.common_fightAttr2
	    proData[2].value = config.attack
	    proData[3] = {}
	    proData[3].name = Desc.common_fightAttr4
	    proData[3].value = config.magic
	    proData[4] = {}
	    proData[4].name = Desc.common_fightAttr3
	    proData[4].value = config.defense
	    proData[5] = {}
	    proData[5].name = Desc.common_fightAttr5
	    proData[5].value = config.magicDefense
	    proData[6] = {}
	    proData[6].name = Desc.common_fightAttr6
	    proData[6].value = config.speed
	   
		proList:setItemRenderer(function (index,obj)
		   local txt = obj:getChildAutoType("title")
		   local val = obj:getChildAutoType("value")
		   txt:setText(proData[index+1].name)
		   val:setText("+"..proData[index+1].value)
		end)
		proList:setNumItems(#proData)
        
        itemList:setItemRenderer(function (index,obj)
		    local itemcell = BindManager.bindItemCell(obj)
	        local itemData = ItemsUtil.createItemData({data = config.reward[index+1]})
	        -- itemcell:setIsBig(true)
			itemcell:setItemData(itemData)
		end)
		itemList:setData(config.reward)

	end)
	self.list:setVirtual()
    self:updatePanel()
end

function DutyWatchView:updatePanel(  )
  self.allConfig = DutyModel:getAllDutyConfig()
  self.list:setData(self.allConfig)
  local curDutyIndex = DutyModel:getCurDutyIndex()
  if curDutyIndex == #self.allConfig then
  	curDutyIndex =  curDutyIndex -1
  end
  self.list:scrollToView(curDutyIndex,true,false)
end




return DutyWatchView