--Name : WorldChallengeIntegralView.lua
--Author : generated by FairyGUI
--Date : 2020-5-26
--Desc : 排行榜
local RankView = require "Game.Modules.Rank.RankView"
local WorldChallengeIntegralView,Super = class("WorldChallengeIntegralView", RankView)
local RankConfiger = require "Game.ConfigReaders.RankConfiger" 
local ItemCell = require "Game.UI.Global.ItemCell"
function WorldChallengeIntegralView:ctor()
	--LuaLog("WorldChallengeIntegralView ctor")
	self._packName = "WorldChallenge"
	self._compName = "WorldChallengeIntegralView"
	--self._rootDepth = LayerDepth.Window
	
end


-- function WorldChallengeIntegralView:_initVM( )
-- 	local vmRoot = self
-- 	local viewNode = self.view
-- 	---Do not modify following code--------
-- 	--{vmFields}:WorldChallenge.WorldChallengeIntegralView
-- 		--{vmFieldsEnd}:WorldChallenge.WorldChallengeIntegralView
-- 	--Do not modify above code-------------
-- end

function WorldChallengeIntegralView:_initUI(... )
	--self:_initVM()
	Super._initUI(self, ... )
	self.list_rank=self.view:getChildAutoType("list_rank")
	self.c1=self.view:getController("c1")
	
end

function WorldChallengeIntegralView:updateRankInfo(rankType)
	--printTable(152,"PAHANGB",self._rankData)
	self.list_rank:setVirtual()
	self.list_rank:setItemRenderer(
		function(index, obj) 
		local serverInfo=self._rankData[index+1]
		local c1 = obj:getController("c1")
		if index<=2 then
			c1:setSelectedIndex(index)
		else
			c1:setSelectedIndex(3)
		end
		local txt_order=obj:getChildAutoType("$txt_order");	
		-- txt_order:setText(GMethodUtil.getSizeString(index+1,44)..GMethodUtil.getSizeString("强",44)) 
		txt_order:setText(index+1) 
		local txt_name=obj:getChildAutoType("txt_name");
		if serverInfo.name==nil then 
			printTable(152,"PAHANGB",serverInfo,serverInfo.name)
			txt_name:setText("")
		else
			txt_name:setText(serverInfo.name.."")
		end
		local txt_combat=obj:getChildAutoType("txt_combat");
		local  combat=serverInfo.combat or 0
		txt_combat:setText(Desc.materialCopy_str5.." "..StringUtil.transValue(combat))
		local txt_1=obj:getChildAutoType("txt_1");
		local txt_2=obj:getChildAutoType("txt_2");
		local txt_3=obj:getChildAutoType("txt_3");
		local txt_4=obj:getChildAutoType("txt_4");
		local txt_num1=obj:getChildAutoType("txt_num1");
		
		if serverInfo.extraData and serverInfo.extraData.worldAreanPlayerScore then
		local top=serverInfo.extraData.worldAreanPlayerScore.topRecord
		if top[1]~=nil then
			txt_1:setText(top[1].count.."")
		end
		if top[2]~=nil then
			txt_2:setText(top[2].count.."")
		end
		if top[3]~=nil then
				txt_3:setText(top[3].count.."")
		end
		if top[4]~=nil then
			txt_4:setText(top[4].count.."")
		end
		if index==0 then
			printTable(31,"wwqqqqqqqqqqqq",top[1].count,top[2].count,top[3].count,top[4].count)
		end
		end
		txt_num1:setText(serverInfo.value.."")
		 local playerHead=obj:getChildAutoType("headItem");
		local heroItem = BindManager.bindPlayerCell(playerHead)
		heroItem:setHead(serverInfo.head, serverInfo.level,nil,nil,serverInfo.headBorder)
		playerHead:removeClickListener(100)
		playerHead:addClickListener(
		function(...)
			ViewManager.open("ViewPlayerView",{playerId = serverInfo.id,serverId = serverInfo.serverId,arrayType=GameDef.BattleArrayType.WorldArena})
		end,100
	)

		end
	)
	local count=0
	if next(self._rankData)~=nil then
		count=#self._rankData
	end
	if count==0 then
		self.c1:setSelectedIndex(1)
	else
		self.c1:setSelectedIndex(0)
	end
	self.list_rank:setNumItems(count)
end


--这个方法给特殊排行榜继承后加需要特殊处理的内容
function WorldChallengeIntegralView:updateItemSpec(obj, rank, info, isMine)

end

function WorldChallengeIntegralView:updateItemBaseInfo(obj, rank, info, isMine)
	printTable(16,">>>>>>>>sdfwe",rank)
	-- local c1 = obj:getController("c1")
	-- if(rank == 0) then
	-- 	c1:setSelectedIndex(0)
	-- elseif(rank <= 3 ) then
	-- 	c1:setSelectedIndex(1)
	-- 	rankIcon:setURL(string.format("%s%s.png","UI/Rank/Rank_img_",rank))
	-- else
	-- 	c1:setSelectedIndex(2)
	-- 	txt_rank:setText(rank)
	-- end
	-- local headItem = obj:getChildAutoType("headItem")
	-- obj:removeClickListener(100)   --移除通用处理添加的监听 
	-- headItem:removeClickListener(100)
	-- headItem:addClickListener(
	-- 	function(...)
	-- 		ViewManager.open("FriendCheckView",{playerId = info.id})
	-- 	end,100
	-- )
end

function WorldChallengeIntegralView:updateItemPlayerHead(obj, rank, info, isMine)

end

function WorldChallengeIntegralView:updateItemHeroHead(obj, rank, info, isMine)

end

function WorldChallengeIntegralView:updateItemAttr(obj, rank, info, isMine)

end

function WorldChallengeIntegralView:_initEvent( )
	
end

return WorldChallengeIntegralView