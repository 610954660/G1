--Name : WorldChallengeHallPlayerView.lua
--Author : generated by FairyGUI
--Date : 2020-5-23
--Desc : 
--名人堂
local WorldChallengeHallPlayerView,Super = class("WorldChallengeHallPlayerView", Window)

function WorldChallengeHallPlayerView:ctor()
	--LuaLog("WorldChallengeHallPlayerView ctor")
	self._packName = "WorldChallenge"
	self._compName = "WorldChallengeHallPlayerView"
	--self._rootDepth = LayerDepth.Window
	self.skeletonNode={}
	self.mode = self._args.mode or WorldChallengeModel.matchMode
end

function WorldChallengeHallPlayerView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:WorldChallenge.WorldChallengeHallPlayerView
		vmRoot.heroCell6 = viewNode:getChildAutoType("$heroCell6")--
		vmRoot.heroCell5 = viewNode:getChildAutoType("$heroCell5")--
		vmRoot.heroCell7 = viewNode:getChildAutoType("$heroCell7")--
		vmRoot.heroCell8 = viewNode:getChildAutoType("$heroCell8")--
		vmRoot.btn_celebrity = viewNode:getChildAutoType("$btn_celebrity")--Button
		vmRoot.btn_reward = viewNode:getChildAutoType("$btn_reward")--Button
		vmRoot.heroCell2 = viewNode:getChildAutoType("$heroCell2")--
		vmRoot.heroCell1 = viewNode:getChildAutoType("$heroCell1")--
		vmRoot.heroCell4 = viewNode:getChildAutoType("$heroCell4")--
		vmRoot.heroCell3 = viewNode:getChildAutoType("$heroCell3")--
	--{vmFieldsEnd}:WorldChallenge.WorldChallengeHallPlayerView
	--Do not modify above code-------------
end


function WorldChallengeHallPlayerView:_initUI( )
	local root = self
	local rootView = self.view
		root.btn_arrow = rootView:getChildAutoType("btn_arrow") -- 模式切换箭头按钮
		root.txt_mode = rootView:getChildAutoType("txt_mode") -- 模式
	local ctrl = rootView:getController("arrowCtrl")
	ctrl:setSelectedIndex(1 - self.mode)
	self.txt_mode:setText(Desc["WorldChallenge_mode"..self.mode])

	self:_initVM()
	local url="UI/WorldChallenge/worldchallengeMingrentang.jpg"
	GMethodUtil:setFrameViewBg(self.view,url)
	self:getHalloffameData()
end

function WorldChallengeHallPlayerView:getHalloffameData()
	local model = WorldChallengeModel:getModelByType(self.mode)
	model:seeHalloffame()
end

function WorldChallengeHallPlayerView:showView()
	local model = WorldChallengeModel:getModelByType(self.mode)
	local serverInfo=model.HonourInfo
	printTable(30,"wwwwwwwwaaaaa",serverInfo)
	local playerMap={}
	if serverInfo and serverInfo.playerInfo then
		for key, value in pairs(serverInfo.playerInfo) do
			playerMap[#playerMap+1]=value
		end
	end
	TableUtil.sortByMap(playerMap, {{key="topType",asc=false},{key="playerId",asc=false}} )	
	printTable(152,"wwwwwwww",playerMap)
	for i = 1, 8, 1 do
		local item=self.view:getChild("$heroCell"..i)
		local c1=item:getController("c1")
		local c2=item:getController("c2")
	 	local txt_name=item:getChildAutoType("txt_name")--
		local txt_level=item:getChildAutoType("txt_level")
		local com_mode=item:getChildAutoType("com_mode")
		local info= playerMap[i]
		if info then
			c1:setSelectedIndex(1)
			if info.topType==1 then
				c2:setSelectedIndex(0)
			elseif info.topType==2 then
				c2:setSelectedIndex(1)
			elseif info.topType==3 then
				c2:setSelectedIndex(2)
			else
				c2:setSelectedIndex(3)
			end
			txt_name:setText(info.name)
			txt_level:setText(Desc.itemtips_attrNameLv..info.level)
			local configItem=DynamicConfigData.t_hero[info.heroOpertion]
			if not configItem then
				return
			end
			local  modeId= configItem.model	
			local skeletonNode = SpineMnange.createSprineById(modeId,nil,nil,nil,info.fashionCode)
			if not skeletonNode then
				return
			end
			com_mode:displayObject():addChild(skeletonNode)
			skeletonNode:setAnimation(0, "stand", true)
			if self.skeletonNode[i] then
				self.skeletonNode[i]:removeFromParent()
			end
			self.skeletonNode[i] = skeletonNode
		else
			c1:setSelectedIndex(0)
		end
	end
end

function WorldChallengeHallPlayerView:worldChallenge_HonourInfoupdateInfo()
	self:showView()
end

function WorldChallengeHallPlayerView:_initEvent()
	self.btn_celebrity:addClickListener(function (context)--名人堂积分榜
		local type = self.mode == 1 and GameDef.RankType.WorldSkyPvpPlayerScore or GameDef.RankType.WorldArenaPlayerScore
		ViewManager.open("WorldChallengeIntegralView", {type = type})
	end)
	self.btn_reward:addClickListener(function (context)--赛季奖励
		ViewManager.open("WorldChallengeRewardView", {mode = self.mode})
	end)
	self.btn_arrow:addClickListener(function() 
		self.mode = 1 - self.mode
		local ctrl = self.view:getController("arrowCtrl")
		ctrl:setSelectedIndex(1 - self.mode)
		self.txt_mode:setText(Desc["WorldChallenge_mode"..self.mode])
		self:getHalloffameData()
	end)
end

return WorldChallengeHallPlayerView