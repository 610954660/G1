--Date :2021-01-22
--Author : generated by FairyGUI
--Desc : 

local ViewPlayerHallowSkillTipView,Super = class("ViewPlayerHallowSkillTipView", Window)

function ViewPlayerHallowSkillTipView:ctor(args)
	--LuaLog("ViewPlayerHallowSkillTipView ctor")
	self._packName = "PlayerInfo"
	self._compName = "ViewPlayerHallowSkillTipView"
	self._rootDepth = LayerDepth.Tips
	
	self.data = args
	self.skillData = false
end

function ViewPlayerHallowSkillTipView:_initEvent( )
	
end

function ViewPlayerHallowSkillTipView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:PlayerInfo.ViewPlayerHallowSkillTipView
	self.blackbgAlpha = viewNode:getChildAutoType('blackbgAlpha')--GLabel
	self.iconLoader = viewNode:getChildAutoType('iconLoader')--skillIconLoader
		self.iconLoader.iconLoader = viewNode:getChildAutoType('iconLoader/iconLoader')--GLoader
	self.img_bg = viewNode:getChildAutoType('img_bg')--GImage
	self.list_attr = viewNode:getChildAutoType('list_attr')--GList
	self.list_skill = viewNode:getChildAutoType('list_skill')--GList
	self.txt_level = viewNode:getChildAutoType('txt_level')--GTextField
	self.txt_levelName = viewNode:getChildAutoType('txt_levelName')--GTextField
	self.txt_name = viewNode:getChildAutoType('txt_name')--GTextField
	self.txt_noSkill = viewNode:getChildAutoType('txt_noSkill')--GTextField
	--{autoFieldsEnd}:PlayerInfo.ViewPlayerHallowSkillTipView
	--Do not modify above code-------------
	
end

function ViewPlayerHallowSkillTipView:_initListener( )
	
	self.list_attr:setItemRenderer(function(index, obj)
		local curTxt = obj:getChildAutoType("txt_name")
		local addTxt = obj:getChildAutoType("txt_num")
		local value = self.attrData[index + 1]
		
        curTxt:setText(GMethodUtil:getFightAttrName(value.attrId))
        local attrValue=GMethodUtil:getFightAttrName(value.attrId,value.value)
        addTxt:setText(attrValue)
	end)

	self.list_skill:setItemRenderer(function(index, obj)
		local skillCell = obj:getChildAutoType("skillCell")
		local txt_level = obj:getChildAutoType("txt_level")
		local skillCellObj = BindManager.bindSkillCell(skillCell)
		local data = self.skillData[index + 1]
		skillCellObj:setData(data.skillId, true)
		txt_level:setText("Lv."..data.level)
	end)

end

function ViewPlayerHallowSkillTipView:_initUI( )
	self:_initVM()
	self:_initListener()
	
	self.iconLoader.iconLoader:setURL(string.format("UI/Hallow/hallow%s.png", self.data.data.hallowType))
	self.txt_name:setText(Desc["common_category"..self.data.id].."圣器")
	self.txt_level:setText(self.data.data.level)
	
	local skillData = {}
	local ConfigInfo=DynamicConfigData.t_HallowLevel[self.data.data.hallowType][self.data.data.level]
	local skillMap = ConfigInfo.skill
	for i = 1, #skillMap, 1 do
		local skillId=skillMap[i]
		if skillId > 0 then
			local lv = skillId - math.floor(skillId / 10) * 10;
			table.insert(skillData, {skillId = skillId, level = lv})
		end
	end
	
	self.attrData = ConfigInfo.hallowAttr
	self.list_attr:setData(self.attrData)
	self.skillData = skillData
	self.list_skill:setNumItems(#skillData);
	self.txt_noSkill:setVisible(#skillData == 0)
end

return ViewPlayerHallowSkillTipView
