--Date :2021-01-23
--Author : generated by FairyGUI
--Desc : 

local ViewPlayerScrectWeaponTipView,Super = class("ViewPlayerScrectWeaponTipView", Window)

function ViewPlayerScrectWeaponTipView:ctor(args)
	--LuaLog("ViewPlayerScrectWeaponTipView ctor")
	self._packName = "PlayerInfo"
	self._compName = "ViewPlayerScrectWeaponTipView"
	self._rootDepth = LayerDepth.Tips
	self.data = args
	self.stageData = false
	self.levelData = false
end

function ViewPlayerScrectWeaponTipView:_initEvent( )
	
end

function ViewPlayerScrectWeaponTipView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:PlayerInfo.ViewPlayerScrectWeaponTipView
	self.blackbgAlpha = viewNode:getChildAutoType('blackbgAlpha')--GLabel
	self.iconLoader = viewNode:getChildAutoType('iconLoader')--skillIconLoader
		self.iconLoader.iconLoader = viewNode:getChildAutoType('iconLoader/iconLoader')--GLoader
	self.img_bg = viewNode:getChildAutoType('img_bg')--GImage
	self.list_attr = viewNode:getChildAutoType('list_attr')--GList
	self.list_starAttrTotal = viewNode:getChildAutoType('list_starAttrTotal')--GList
	self.txt_desc = viewNode:getChildAutoType('txt_desc')--GRichTextField
	self.txt_level = viewNode:getChildAutoType('txt_level')--GTextField
	self.txt_levelName = viewNode:getChildAutoType('txt_levelName')--GTextField
	self.txt_name = viewNode:getChildAutoType('txt_name')--GTextField
	--{autoFieldsEnd}:PlayerInfo.ViewPlayerScrectWeaponTipView
	--Do not modify above code-------------
end

function ViewPlayerScrectWeaponTipView:_initListener( )
	
	self.list_attr:setItemRenderer(function(index, obj)
		local txt_name = obj:getChildAutoType("txt_name")
		local txt_num = obj:getChildAutoType("txt_num")
		local data = self.levelData[index + 1]
		
		txt_name:setText(GMethodUtil:getFightAttrName(data.type))
        local attrValue=GMethodUtil:getFightAttrName(data.type,data.value)
        txt_num:setText(attrValue)
	end)

	self.list_starAttrTotal:setItemRenderer(function(index, obj)
		local txt_name = obj:getChildAutoType("txt_name")
		local data = self.stageData[index + 1]
		obj:getController("grayCtrl"):setSelectedIndex(data.notActive)
		txt_name:setText(data.desc)
	end)

end

function ViewPlayerScrectWeaponTipView:_initUI( )
	self:_initVM()
	self:_initListener()
	local level = self.data.level or -1
	if level > #DynamicConfigData.t_godArms[self.data.curId] then level = #DynamicConfigData.t_godArms[self.data.curId] end 
	local elfConfig = DynamicConfigData.t_godArms[self.data.curId][level]  --技能读第一个就行了
	self.txt_name:setText(elfConfig.name)
	self.txt_level:setText(self.data.level)
	local equipurl = SecretWeaponsModel:getEquipById(self.data.curId)
	self.iconLoader.iconLoader:setURL(equipurl)

	local skillId = elfConfig.skillId
	local skillData = DynamicConfigData.t_skill[skillId]
	local str = string.format(Desc.Friend_check_txt12,level, skillData.showName)
	--local colorstr = ColorUtil.formatColorString1(str, colol)
	self.txt_desc:setText(str)
	
	local levelConfig = DynamicConfigData.t_godArmsLevel[self.data.level]
	self.levelData = levelConfig.addAttr
	self.list_attr:setNumItems(#self.levelData)
	
	local stageData = {}
	for _,v in pairs(DynamicConfigData.t_godArmsStage) do
		if v.desc and v.desc ~= "" then
			table.insert(stageData, {desc = v.desc,notActive = self.data.stage >= v.godArmsStage and 0 or 1})
		end
	end
	TableUtil.sortByMap(stageData, {{key="notActive", asc=false}})
	self.stageData = stageData
	self.list_starAttrTotal:setNumItems(#self.stageData)
end




return ViewPlayerScrectWeaponTipView