--Date :2021-01-13
--Author : generated by FairyGUI
--Desc : 

local CrossLaddersChampGuessView,Super = class("CrossLaddersChampGuessView", Window)

function CrossLaddersChampGuessView:ctor()
	--LuaLog("CrossLaddersChampGuessView ctor")
	self._packName = "CrossLaddersChamp"
	self._compName = "CrossLaddersChampGuessView"
	self._rootDepth = LayerDepth.PopWindow
	
end

function CrossLaddersChampGuessView:_initEvent( )
	
end

function CrossLaddersChampGuessView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:CrossLaddersChamp.CrossLaddersChampGuessView
	self.btn_add = viewNode:getChildAutoType('$btn_add')--GButton
	self.btn_back = viewNode:getChildAutoType('$btn_back')--GButton
	self.blackbg = viewNode:getChildAutoType('blackbg')--GLabel
	self.btn_cancel = viewNode:getChildAutoType('btn_cancel')--GButton
	self.btn_ok = viewNode:getChildAutoType('btn_ok')--GButton
	self.frame = viewNode:getChildAutoType('frame')--GLabel
	self.guessTxt = viewNode:getChildAutoType('guessTxt')--GRichTextField
	self.slider = viewNode:getChildAutoType('slider')--Slider2
		self.slider.num1 = viewNode:getChildAutoType('slider/num1')--GRichTextField
		self.slider.num2 = viewNode:getChildAutoType('slider/num2')--GRichTextField
	--{autoFieldsEnd}:CrossLaddersChamp.CrossLaddersChampGuessView
	--Do not modify above code-------------
end

function CrossLaddersChampGuessView:_initListener( )
	
	self.btn_add:addClickListener(function()
		local addNum = 1
		addNum = addNum + self.slider:getValue()
		if addNum > self.maxNum then
			addNum = self.maxNum
		end
		self.slider.num1:setText(Desc.DreamMasterPvp_guess1:format(addNum))
		self.slider:setValue(addNum)
	end,33)
	
	self.btn_back:addClickListener(function()
		local addNum = 1
		addNum = self.slider:getValue() - addNum
		if addNum < 0 then
			addNum = 0
		end
		self.slider.num1:setText(Desc.DreamMasterPvp_guess1:format(addNum))
		self.slider:setValue(addNum)
	end,33)

	self.btn_cancel:addClickListener(function()
		self:closeView()
	end,33)
	
	self.btn_ok:addClickListener(function()
		if self.slider:getValue() <=0 then
			RollTips.show(Desc.DreamMasterPvp_nojifen)
		 	return 
		end
		local data = self._args
		CrossLaddersChampModel:reqSkyLadChampion_DoGuess(data.nodeId,data.pos,data.supportId,self.slider:getValue(),function()
			Dispatcher.dispatchEvent(EventType.CrossLaddersChampQuizView_refreshPanel)
		end)
		self:closeView()
	end,33)

end

function CrossLaddersChampGuessView:_initUI( )
	self:_initVM()
	self:_initListener()
	self.maxNum = DynamicConfigData.t_SkyLadChampionConst[1].limitCoin
	local myScore = CrossLaddersChampModel.quizCion
	if myScore < self.maxNum then
		self.maxNum = myScore
	end
	local function onChanged( ... )
    	local value = math.ceil(self.slider:getValue()/100*self.maxNum)
    	if value<=1 then value = 1 end
    	
    	self.slider.num1:setText(Desc.DreamMasterPvp_guess1:format(self.slider:getValue()))
	end

	self.slider.num1:setText(Desc.DreamMasterPvp_guess1:format(0))
	self.slider.num2:setText(Desc.DreamMasterPvp_guess2:format(self.maxNum))
	self.slider:setMax(self.maxNum)
	self.slider:setValue(0)
	self.slider:addEventListener(FUIEventType.Changed, onChanged);

	self.guessTxt:setText(Desc.DreamMasterPvp_guessTxt:format(myScore,self._args.guessName))
end




return CrossLaddersChampGuessView