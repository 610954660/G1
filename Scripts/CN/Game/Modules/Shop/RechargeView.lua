--Name : RechargeView.lua
--Author : generated by FairyGUI
--Date : 2020-3-6
--Desc : 

local RechargeView,Super = class("RechargeView", Window)

function RechargeView:ctor()
	--LuaLog("RechargeView ctor")
	self._packName = "Shop"
	self._compName = "rechargeView"
	self._isFullScreen = true
	--self._rootDepth = LayerDepth.Window
	self.chargeData = false
end

function RechargeView:_initEvent( )
	
end

function RechargeView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:Shop.RechargeView
		--{vmFieldsEnd}:Shop.RechargeView
	--Do not modify above code-------------
end

function RechargeView:_initUI( )
	self:_initVM()
	
	--SDKUtil.getRealNameInfo()

	self.rechargeList = self.view:getChildAutoType("list")
	
	
	self.rechargeList:setItemRenderer(function(index,obj)
			self:itemShow(obj,index)
		end
	)
	
	RechargeModel:getChargeList(function()
		self:updateChargeList()
	end)
end

function RechargeView:updateChargeList()
	if tolua.isnull(self.view) then return end
	self.chargeData = ModelManager.RechargeModel:getChargeData()
	self.chargeData = TableUtil.sortByMap(self.chargeData, {{key="money",asc=false}})
	self.rechargeList:setNumItems(#self.chargeData)
end
function RechargeView:charge_status_change()
	RechargeModel:getChargeList(function()
		self:updateChargeList()
	end)
end



function RechargeView:itemShow( obj,index )

	print(33,"itemShow = ",index)
	local data = self.chargeData[index + 1]
	


	local moneyText = obj:getChildAutoType("money")

	moneyText:setText(DescAuto[181]..data.money); -- [181]="￥"

	local icon = obj:getChildAutoType("icon")
	icon:setURL(PathConfiger.getRechargeIcon(data.icon))

	local txt_give = obj:getChildAutoType("txt_give")
	local txt_once = obj:getChildAutoType("txt_once")
	local img_give = obj:getChildAutoType("img_give")
	if ModelManager.RechargeModel:getRechargeTimes(tonumber(data.money)) == 0 then
		txt_give:setText(string.format(Desc.recharge_fistGive,data.gold))
		txt_once:setVisible(true)
		img_give:setVisible(true)
	else
		if tonumber(data.giveGold) > 0 then
			txt_give:setText(string.format(Desc.recharge_give,data.giveGold))
			img_give:setVisible(true)
		else
			txt_give:setText("")
			img_give:setVisible(false)
		end
		txt_once:setVisible(false)
	end
	
	local numText = obj:getChildAutoType("num")
	numText:setText(""..data.gold);

	obj:removeClickListener(33)--池子里面原来的事件注销掉
	obj:addClickListener(function(context)
			
			local info = {}
			info.text = string.format(Desc.recharge_hint,DescAuto[181],data.money,data.gold) -- [181]="￥"
			info.type = "yes_no"
			info.align = "center"
			info.mask = true
			info.onYes = function()
				ModelManager.RechargeModel:doPay(data.money, Desc.recharge_name, nil, data.giveGold)
			end
			Alert.show(info)
	
		end,33)


end

return RechargeView
