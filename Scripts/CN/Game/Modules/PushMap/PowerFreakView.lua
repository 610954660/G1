--Date :2021-01-18
--Author : generated by FairyGUI
--Desc : 

local PowerFreakView,Super = class("PowerFreakView", Window)

function PowerFreakView:ctor()
	--LuaLog("PowerFreakView ctor")
	self._packName = "PushMap"
	self._compName = "PowerFreakView"
	self._rootDepth = LayerDepth.PopWindow
	
	self.diff=1
	self.levelInfo=false
	self.noFightCount=false
	
end

function PowerFreakView:_initEvent( )
	
end

function PowerFreakView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:PushMap.PowerFreakView
	self.beatPt = viewNode:getChildAutoType('beatPt')--GTextField
	self.btn_Fight = viewNode:getChildAutoType('btn_Fight')--GButton
	self.frame = viewNode:getChildAutoType('frame')--GLabel
	self.heroList = viewNode:getChildAutoType('heroList')--GList
	self.rewardList = viewNode:getChildAutoType('rewardList')--GList
	self.skillList = viewNode:getChildAutoType('skillList')--GList
	self.tabBar = viewNode:getChildAutoType('tabBar')--GList
	--{autoFieldsEnd}:PushMap.PowerFreakView
	--Do not modify above code-------------
end

function PowerFreakView:_initListener( )
	
	local bossInfo=self._args.bossInfo
	self.btn_Fight:addClickListener(function()
	     if self.noFightCount then
			RollTips.show(Desc.CrossTeamPVP_notFight1)
			return 
		 end
		 PushMapModel:powerPlanDoFight(self.levelInfo.nodeId,bossInfo.bossId,self.diff)
		 ViewManager.close("PowerFreakView")
	end)

	self.heroList:setItemRenderer(function(index, obj)

		local monsterInfo= PushMapModel:getMonsterByBossId(bossInfo.bossId,index+1)
		local heroCell=BindManager.bindHeroCell(obj)
		heroCell:setBaseData(monsterInfo)
	end)

	self.rewardList:setItemRenderer(function(index, obj)
			--local levelInfo=DynamicConfigData.t_TalentProjectGame[bossInfo.bossId][self.diff]
			local rewardData=self.levelInfo.reward[index+1]
			local itemcell=BindManager.bindItemCell(obj)
			local itemData = ItemsUtil.createItemData({data = rewardData})
			itemcell:setItemData(itemData)
	end)

	self.skillList:setItemRenderer(function(index, obj)
			--local levelInfo=DynamicConfigData.t_TalentProjectGame[bossInfo.bossId][self.diff]
			local skillId=self.levelInfo.extraSkill[index+1]
			local skillCell=BindManager.bindSkillCell(obj)
			skillCell:setData(skillId,true)
	end)


	self.tabBar:setSelectedIndex(0)
	self.tabBar:regUnscrollItemClick(function (i)
			self.diff=i+1
			self:iniData()
	end)

end

function PowerFreakView:_initUI( )
	self:_initVM()
	self:_initListener()
    self:iniData()
end

function PowerFreakView:iniData()
	local bossInfo=self._args.bossInfo
	self.levelInfo=DynamicConfigData.t_TalentProjectGame[self._args.nodeId][bossInfo.bossId][self.diff]
	self.beatPt:setText(self.levelInfo.beatPt)
	self.heroList:setNumItems(8)
	self.skillList:setNumItems(2)
	self.rewardList:setNumItems(table.nums(self.levelInfo.reward))
	self.noFightCount=self._args.dayFightCount>=DynamicConfigData.t_TalentProjectConst[1].challengeTimes
	self.btn_Fight:setTitle(string.format(Desc.powerPlant_desc4,DynamicConfigData.t_TalentProjectConst[1].challengeTimes-self._args.dayFightCount,DynamicConfigData.t_TalentProjectConst[1].challengeTimes))
	--if self.noFightCount then
		--self.btn_Fight:setGrayed(true)
		--self.btn_Fight:setTouchable(false)
	--end
end


return PowerFreakView