--Date :2021-01-18
--Author : generated by FairyGUI
--Desc : 

local PowerRewardView,Super = class("PowerRewardView", Window)

function PowerRewardView:ctor()
	--LuaLog("PowerRewardView ctor")
	self._packName = "PushMap"
	self._compName = "PowerRewardView"
	self._rootDepth = LayerDepth.PopWindow
	
end

function PowerRewardView:_initEvent( )
	
end

function PowerRewardView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:PushMap.PowerRewardView
	self.blackbg = viewNode:getChildAutoType('blackbg')--GLabel
	self.frame = viewNode:getChildAutoType('frame')--GLabel
	self.rewardList = viewNode:getChildAutoType('rewardList')--GList
	--{autoFieldsEnd}:PushMap.PowerRewardView
	--Do not modify above code-------------
end

function PowerRewardView:_initListener( )
	

end

function PowerRewardView:_initUI( )
	self:_initVM()
	self:_initListener()
	self:setData()
end

function PowerRewardView:setData( )
	local rewards= PushMapModel:getPeriodReward()
	self.rewardList:setVirtual()
	self.rewardList:setItemRenderer(function (index,item)
			local listData=rewards[index+1]
			local itemRewardList=item:getChildAutoType("rewardList")	
			itemRewardList:setItemRenderer(function (cindex,citem)
					local rewardData=listData.reward[cindex+1]
					local itemcell=BindManager.bindItemCell(citem)
					local itemData = ItemsUtil.createItemData({data = rewardData})
					itemcell:setItemData(itemData)
			end)
			itemRewardList:setNumItems(#listData.reward)	
			item:setTitle("第"..listData.nodeId.."阶段奖励")
			item:removeClickListener(1)
			if listData.status==0 then
				item:getController("status"):setSelectedPage("got")
			end
			if listData.status==1 then
				item:getController("status"):setSelectedPage("unavailable")
			end
			if listData.status==2 then
				item:getController("status"):setSelectedPage("get")
				item:addClickListener(function ()
						PushMapModel:powerPlanRecvReward(listData.nodeId,function ()
								PushMapModel:powerPlanGetInfo(function (data)
										if tolua.isnull(self.view) then
											return
										end
										self:setData()
									end)
						end)
				end,1)
			end
			
	end)
	self.rewardList:setNumItems(#rewards)

end




return PowerRewardView