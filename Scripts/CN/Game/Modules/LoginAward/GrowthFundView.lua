--Name : GrowthFundView.lua
--Author : generated by FairyGUI
--Date : 2020-7-31
--Desc : 
--成长基金
local GrowthFundView,Super = class("GrowthFundView", Window)
local growthType = 1
function GrowthFundView:ctor()
	--LuaLog("GrowthFundView ctor")
	self._packName = "LoginAward"
	self._compName = "GrowthFundView"
	--self._rootDepth = LayerDepth.Window
	self.config = false
	self.data = false
	self.isBuyFlag = false
end

function GrowthFundView:_initEvent( )
	self:update_Growth()
end

function GrowthFundView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:LoginAward.GrowthFundView
		vmRoot.showValue = viewNode:getChildAutoType("$showValue")--text
		vmRoot.list = viewNode:getChildAutoType("$list")--list
		vmRoot.showBack = viewNode:getChildAutoType("$showBack")--text
		vmRoot.btn_buy = viewNode:getChildAutoType("$btn_buy")--Button
		vmRoot.money = viewNode:getChildAutoType("$money")--Button
		vmRoot.level = viewNode:getChildAutoType("$level")
	--{vmFieldsEnd}:LoginAward.GrowthFundView
	--Do not modify above code-------------
end

function GrowthFundView:_initUI( )
	self:_initVM()
	--请求信息
 --    local params = {}
	-- RPCReq.Fund_SendInfo(params, params.onSuccess)
    self.view:getChildAutoType("lihuiImg"):setURL(PathConfiger.getBg("czjj_lihui.png"))
    self.level:setText(PlayerModel.level)
	self.list:setItemRenderer(function( index,obj )
		local title = obj:getChildAutoType("title")
		local level = obj:getChildAutoType("level")
		local showLoader1 = obj:getChildAutoType("showLoader1")
		local showNum1 = obj:getChildAutoType("showNum1")
		local showLoader2 = obj:getChildAutoType("showLoader2")
		local showNum2 = obj:getChildAutoType("showNum2")
		local getBtn = obj:getChildAutoType("getBtn")
		local typeCtrl = obj:getController("typeCtrl")
		local listConfig = self.config[index+1]
		level:setText(listConfig.level)
		local url = ItemConfiger.getItemIconByCode(listConfig.itemShow1[1].code,listConfig.itemShow1[1].type,true)
		showLoader1:setURL(url)
		showNum1:setText(listConfig.itemShow1[1].amount)
		local ur2 = ItemConfiger.getItemIconByCode(listConfig.itemShow2[1].code,listConfig.itemShow2[1].type,true)
		showLoader2:setURL(ur2)
		showNum2:setText(listConfig.itemShow2[1].amount)
		getBtn:removeClickListener(11)
		getBtn:getChildAutoType("img_red"):setVisible(false)
		--根据服务器状态
		typeCtrl:setSelectedIndex(self.data[index+1]-1)
		if self.data[index+1] ==1 then --未达成目标

			-- getBtn:setTitle("未达成")
			-- getBtn:setGrayed(true)
			getBtn:setTouchable(false)
		elseif self.data[index+1] ==2 then --达成目标未购买
			-- getBtn:setTitle("领取")
			-- getBtn:setGrayed(false)
			getBtn:setTouchable(true)
			getBtn:addClickListener(function( ... )
				RollTips.show(DescAuto[179]) -- [179]="购买后即可领取"
			end)
		elseif self.data[index+1] ==3 then --达成目标已购买
			-- getBtn:setTitle("领取")
			-- getBtn:setGrayed(false)
			getBtn:setTouchable(true)
			getBtn:getChildAutoType("img_red"):setVisible(true)
			getBtn:addClickListener(function( ... )
				local params = {}
				params.type = growthType
				params.id = index+1
				printTable(1,params)
				params.onSuccess = function( res )
				end
		        RPCReq.Fund_Reward(params, params.onSuccess)
			end,11)
		elseif self.data[index+1] ==4 then --已领取
			-- getBtn:setTitle("已领取")
			-- getBtn:setGrayed(true)
			getBtn:setTouchable(false)
		end
	end)
	
	self.btn_buy:addClickListener(function ( ... )
		-- local params = {}
		-- params.type = growthType
		-- printTable(1,params)
		-- params.onSuccess = function( res )
		-- 	if res == 0 then
		-- 		RollTips.show("购买成功")
		-- 	end
		-- end
  --       RPCReq.Fund_BuyFund(params, params.onSuccess)
        local mainConfig = LoginAwardModel:getGrowthMianConfig( growthType )
        local price=mainConfig.price or 98
		ModelManager.RechargeModel:directBuy(price, GameDef.StatFuncType.SFT_BuyFund,mainConfig.type, Desc.recharge_growthpay,nil, mainConfig.showName1)	
	end)
end

--协议信息返回
function GrowthFundView:update_Growth()
	local serverData = LoginAwardModel:getGrowthData( )
	if not serverData then
		return
	end
    self.data = serverData.state
    self.isBuyFlag = serverData.isBuy
	self.config = LoginAwardModel:getGrowthConfig( growthType )
	self:updatePanel()
end

--更新页面
function GrowthFundView:updatePanel(  )
	self.list:setData(self.config)
	local mainConfig = LoginAwardModel:getGrowthMianConfig( growthType )
    if self.isBuyFlag then
    	self.btn_buy:setTitle(DescAuto[180]) -- [180]="已激活"
    	self.btn_buy:setTouchable(false)
    	self.btn_buy:setGrayed(true)
    else
	    self.btn_buy:setTouchable(true)
    	self.btn_buy:setGrayed(false)
    end
    self.money:setText(DescAuto[181]..mainConfig.price) -- [181]="￥"
	self.showValue:setText(mainConfig.showValue..DescAuto[182]) -- [182]="倍"
	self.showValue:setSkewX(9.0)
	self.showBack:setSkewX(9.0)
	self.showBack:setText(mainConfig.showBack)

end


return GrowthFundView
