--Date :2021-01-18
--Author : generated by FairyGUI
--Desc : 

local GodMarketEvent1View,Super = class("GodMarketEvent1View", Window)

function GodMarketEvent1View:ctor()
	--LuaLog("GodMarketEvent1View ctor")
	self._packName = "GodMarket"
	self._compName = "GodMarketEvent1View"
	self._rootDepth = LayerDepth.PopWindow
	
end

function GodMarketEvent1View:_initEvent( )
	
end

function GodMarketEvent1View:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:GodMarket.GodMarketEvent1View
	self.addNum = viewNode:getChildAutoType('addNum')--GTextField
	self.blackbg = viewNode:getChildAutoType('blackbg')--GLabel
	self.btn_battle = viewNode:getChildAutoType('btn_battle')--GButton
	self.costNum = viewNode:getChildAutoType('costNum')--GRichTextField
	self.enemyList = viewNode:getChildAutoType('enemyList')--GList
	self.frame = viewNode:getChildAutoType('frame')--GLabel
	self.rewardList = viewNode:getChildAutoType('rewardList')--GList
	--{autoFieldsEnd}:GodMarket.GodMarketEvent1View
	--Do not modify above code-------------
end

function GodMarketEvent1View:_initListener( )
	
	self.btn_battle:addClickListener(function()
		Dispatcher.dispatchEvent("godmarket_battle",self.eventData,self.gridData,self.rewardList._dataTemplate)
		self:closeView()
	end)

	self.enemyList:setItemRenderer(function(index, obj)
		local data = self.enemyList._dataTemplate[index+1]
		local heroCell = BindManager.bindHeroCell(obj)
		heroCell:setData(data)
	end)

	self.rewardList:setItemRenderer(function(index, obj)
		local award = self.rewardList._dataTemplate[index+1]
		local itemcell = BindManager.bindItemCell(obj)
		itemcell:setData(award.code, award.amount, award.type)

		obj:removeClickListener(100)
		obj:addClickListener(function( ... )
				itemcell:onClickCell()
			end,100)
	end)

end

function GodMarketEvent1View:_initUI( )
	self:_initVM()
	self:_initListener()

	self.gridData = self._args.gridData
	self.eventData = self._args.eventData
	if self.eventData.eid == 2 then
		self.frame:setTitle(Desc.godmarket_desc17) --godmarket_desc17="高级神土"
	end
	local fightArray =  GodMarketModel:getFightArray( self.eventData.d.fightid[1],self.gridData )

	--TableUtil.sortByMap(ExpeditionModel.enemyArray, {{key="level",asc=true},{key="star",asc=true},{key="combat",asc=true}})
	if fightArray then
		self.enemyList:setData(fightArray.heroInfos)
	end
	self.costNum:setText(string.format("%d/%d",GodMarketModel.costAction,GodMarketModel.serverData.action or 0))
	self.addNum:setText(string.format(Desc.godmarket_desc9,self.eventData.d.reward1[1].amount)) --godmarket_desc9="+%d/小时"
	self.rewardList:setData(GodMarketModel:getActionReward())

	if (GodMarketModel.serverData.action or 0) < 1 then
		--self.btn_battle:setGrayed(true)
		--self.btn_battle:setTouchable(false)
	end
end




return GodMarketEvent1View
