--Name : PolestarPayInfoView.lua
--Author : generated by FairyGUI
--Date : 2020-5-29
--Desc : 

local PolestarPayInfoView,Super = class("PolestarPayInfoView", Window)
local ItemCell = require "Game.UI.Global.ItemCell"
function PolestarPayInfoView:ctor()
	--LuaLog("PolestarPayInfoView ctor")
	self._packName = "OperatingActivities"
	self._compName = "PolestarPayInfoView"
	self._rootDepth = LayerDepth.FaceWindow
	self.chargeId=3201
end

function PolestarPayInfoView:_initEvent( )
	
end

function PolestarPayInfoView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:OperatingActivities.PolestarPayInfoView
		vmRoot.btn_play = viewNode:getChildAutoType("$btn_play")--Button
		vmRoot.list_allReward = viewNode:getChildAutoType("$list_allReward")--list
		vmRoot.list_reward = viewNode:getChildAutoType("$list_reward")--list
	--{vmFieldsEnd}:OperatingActivities.PolestarPayInfoView
	--Do not modify above code-------------
end

function PolestarPayInfoView:_initUI( )
	self:_initVM()
	local price=DynamicConfigData.t_ActiveCollectStarBuy[self.chargeId].price or 98
	self.btn_play:setTitle(string.format(Desc.activity_txt15,price))
	local tableAll={}
	local tableCur={}
	local allrewardInfo={}
	local currewardInfo={}
	local starTotal= OperatingActivitiesModel.polestarActiveInfo.starTotal or 0
	local configInfo=DynamicConfigData.t_ActiveCollectStar
    for key, value in pairs(configInfo) do
       local speciaIndex=OperatingActivitiesModel:GetBitByIndex(OperatingActivitiesModel.polestarActiveInfo.privilegeMark,tonumber(key))
		if speciaIndex==0 and starTotal>=value.starNum then
			table.insert(tableCur,value.privilegeShow)	
		end
		table.insert(tableAll,value.privilegeShow)	
	end
	allrewardInfo=TableUtil:getReward(tableAll,1)
	currewardInfo=TableUtil:getReward(tableCur,1)
printTable(12,">>>>>>>>>dsfaew",allrewardInfo)
	self.list_allReward:setItemRenderer(function(index,rewardObj)
		rewardObj:removeClickListener(100)
		--池子里面原来的事件注销掉
	   local itemcell = BindManager.bindItemCell(rewardObj)
	   local award =allrewardInfo[index + 1]
	   itemcell:setData(award.code, award.amount, award.type)
	  -- itemcell:setFrameVisible(false)
	  rewardObj:addClickListener(function( ... )
		   itemcell:onClickCell()
	   end,100)
	end)
	self.list_allReward:setNumItems(#allrewardInfo);


	self.list_reward:setItemRenderer(function(index,rewardObj)
		rewardObj:removeClickListener(100)
		--池子里面原来的事件注销掉
	   local itemcell = BindManager.bindItemCell(rewardObj)
	   local award =currewardInfo[index + 1]
	   itemcell:setData(award.code, award.amount, award.type)
	  -- itemcell:setFrameVisible(false)
	  rewardObj:addClickListener(function( ... )
		   itemcell:onClickCell()
	   end,100)
	end)
	self.list_reward:setNumItems(#currewardInfo);
end


--事件初始化
function PolestarPayInfoView:_initEvent(...)
    self.btn_play:addClickListener(
		function(...)
			local config = DynamicConfigData.t_ActiveCollectStarBuy[self.chargeId]
			if config then 
				local price=config.price or 98
				ModelManager.RechargeModel:directBuy(price, GameDef.StatFuncType.SFT_CollectStar, config.chargeId, config.name,nil,config.showName1)
			end
			ViewManager.close("PolestarPayInfoView")
            -- RollTips.show("暂未开启充值")
        end
    )
end

return PolestarPayInfoView