--Name : WarmakesPayInfoView.lua
--Author : generated by FairyGUI
--Date : 2020-5-29
--Desc : 

local WarmakesPayInfoView,Super = class("WarmakesPayInfoView", Window)
local ItemCell = require "Game.UI.Global.ItemCell"
function WarmakesPayInfoView:ctor()
	--LuaLog("WarmakesPayInfoView ctor")
	self._packName = "OperatingActivities"
	self._compName = "WarmakesPayInfoView"
	self._rootDepth = LayerDepth.FaceWindow
	self.chargeId=3201
end

function WarmakesPayInfoView:_initEvent( )
	
end

function WarmakesPayInfoView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:OperatingActivities.WarmakesPayInfoView
		vmRoot.btn_play = viewNode:getChildAutoType("$btn_play")--Button
		vmRoot.list_allReward = viewNode:getChildAutoType("$list_allReward")--list
		vmRoot.list_reward = viewNode:getChildAutoType("$list_reward")--list
		vmRoot.txt_dec 	= viewNode:getChildAutoType("$txt_dec")
	--{vmFieldsEnd}:OperatingActivities.WarmakesPayInfoView
	--Do not modify above code-------------
end


function WarmakesPayInfoView:_initUI( )
	self:_initVM()
	local priceid=OperatingActivitiesModel:getWarmakesActiveRealType()
	local price=  DynamicConfigData.t_BpActive[priceid].price or 98
	self.btn_play:setTitle(price..Desc.activity_txt7)

	local exp=  DynamicConfigData.t_BpActive[priceid].getExp or 18000
	self.txt_dec:setText(string.format(Desc.WarmakesActive_exp,exp))

	local tableAll={}
	local tableCur={}
	local allrewardInfo={}
	local currewardInfo={}
	local configInfo=DynamicConfigData.t_BpActiveUp
	local type=OperatingActivitiesModel:getWarmakesActiveRealType()
		local configInfo=configInfo[type]
		if not configInfo then
			return
		end
		local teshulingquLv=OperatingActivitiesModel.WarmakesActiveInfo.seniorRewardLv
		--local curLv,curexp,nextExp=OperatingActivitiesModel:getWarmakesActiveLvAndExp()
		local curLv=OperatingActivitiesModel:getWarmakesActiveAddNumLevel(exp)
		for key, value in pairs(configInfo) do
			local limitLv=value.level
			if limitLv<=curLv and teshulingquLv<curLv then
				table.insert(tableCur,value.payReward)	
			end
			table.insert(tableAll,value.payReward)	
		end
	allrewardInfo=TableUtil:getReward(tableAll,1)
	currewardInfo=TableUtil:getReward(tableCur,1)
printTable(12,">>>>>>>>>dsfaew",allrewardInfo)
	self.list_allReward:setItemRenderer(function(index,rewardObj)
		rewardObj:removeClickListener(100)
		--池子里面原来的事件注销掉
	   local itemcell = BindManager.bindItemCell(rewardObj)
	   local award = allrewardInfo[index + 1]
	   itemcell:setData(award.code, award.amount, award.type)
	  -- itemcell:setFrameVisible(false)
	  rewardObj:addClickListener(function( ... )
		itemcell:onClickCell()
	   end,100)
	end)
	self.list_allReward:setNumItems(#allrewardInfo);


	self.list_reward:setItemRenderer(function(index,rewardObj)
		rewardObj:removeClickListener(100)
		--池子里面原来的事件注销掉
	   local itemcell = BindManager.bindItemCell(rewardObj)
	   local award =currewardInfo[index + 1]
	   itemcell:setData(award.code, award.amount, award.type)
	  -- itemcell:setFrameVisible(false)
	  rewardObj:addClickListener(function( ... )
		   itemcell:onClickCell()
	   end,100)
	end)
	self.list_reward:setNumItems(#currewardInfo);
end


--事件初始化
function WarmakesPayInfoView:_initEvent(...)
    self.btn_play:addClickListener(
		function(...)
			local priceid=OperatingActivitiesModel:getWarmakesActiveRealType()
			local config = DynamicConfigData.t_BpActive[priceid]
			if config then
				local price= config.price or 98
				ModelManager.RechargeModel:directBuy(price, GameDef.StatFuncType.SFT_BuyWarOrder, config.moduleId, Desc.recharge_Warmakes,nil, config.showName1)
			end
            -- RollTips.show("暂未开启充值")
        end
    )
end

return WarmakesPayInfoView