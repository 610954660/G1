--Name : GetCardsUPActivityModel.lua
--Author : generated by FairyGUI
--Date : 2020-9-3
--Desc : UP探员活动招募model


local GetCardsUPActivityModel = class("GetCardsUPActivityModel", BaseModel)

function GetCardsUPActivityModel:ctor()
	self.data = {}
	self.lastHeroCode = 0
end

function GetCardsUPActivityModel:init()

end


function GetCardsUPActivityModel:initData( params )
	self.data = params
	Dispatcher.dispatchEvent("update_upgetCard")
	self:checkRedDot()
end

function GetCardsUPActivityModel:getLastHeroCode(  )
	return self.lastHeroCode
end

function GetCardsUPActivityModel:setLastHeroCode( heroCode )
	self.lastHeroCode = heroCode
end

function GetCardsUPActivityModel:checkRedDot( ... )
	RedManager.addMap("V_ACTIVITY_"..GameDef.ActivityType.UpHero,{"V_SUBACTIVITY_UP"})
    RedManager.updateValue("V_SUBACTIVITY_UP",false)
	local viewData = ActivityModel:getActityByType( GameDef.ActivityType.UpHero )
	if (not self.data.farplane) or (not self.data.farplane.data) then
		return
	end
    if viewData then
    	local config = self:getAllConfig( viewData.showContent.countReward)
    	for k,v in pairs(config) do
    		if  self.data.farplane.data.count>= v.num then
    			local flag = self:checkHadGetAward(v.id)
			    if not flag then
			    	RedManager.updateValue("V_SUBACTIVITY_UP",true)
                   return
			    end
    		end
    	end
    end
    if self.data.farplane.data.freeTimes>0 then
		RedManager.updateValue("V_ACTIVITY_"..GameDef.ActivityType.UpHero,true)
	else
		RedManager.updateValue("V_ACTIVITY_"..GameDef.ActivityType.UpHero,false)
	end
	Dispatcher.dispatchEvent("update_cardListTime")
end

function GetCardsUPActivityModel:getData( ... )
	return self.data.farplane
end

function GetCardsUPActivityModel:getModuleId()
	local moduleId = 1
	local actData = ModelManager.ActivityModel:getActityByType(GameDef.ActivityType.UpHero)
	moduleId = actData and actData.showContent.moduleId or 1
	return moduleId
end

function GetCardsUPActivityModel:getYJHeroConfig( moduleId )
	local config = DynamicConfigData.t_WorldSummon[moduleId]
	local configArr = {}
	for k,v in pairs(config) do
		table.insert(configArr,v)
	end
	return  configArr
end

function GetCardsUPActivityModel:getAllYJZMAllConfig(moduleId)
	return DynamicConfigData.t_WorldSummonShow[moduleId]
end

function GetCardsUPActivityModel:getAllConfig( id )
	-- local type= DynamicConfigData.t_heroLottery[id].type
	return DynamicConfigData.t_LotteryTimesReward[id]
end

function GetCardsUPActivityModel:getConfigByNextId( type,count)
	local config =  DynamicConfigData.t_LotteryTimesReward[type]
	local maxConfig = nil
	local maxCount = 0
	for i,v in ipairs(config) do
		if maxCount < v.num then
			maxCount = v.num
			maxConfig = v
		end
		if v.num>=count then
			return v
		end
	end
	return maxConfig
end

function GetCardsUPActivityModel:checkHadGetAward( id)
	if self.data.farplane and self.data.farplane.data and self.data.farplane.data.rewardRecordMap then
		local tempData = self.data.farplane.data.rewardRecordMap
		for k,v in pairs(tempData) do
			if v.id == id then
				return true
			end
		end
	end
	return false
end

return GetCardsUPActivityModel
