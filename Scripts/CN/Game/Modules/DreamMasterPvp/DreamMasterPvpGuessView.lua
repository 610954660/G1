--Date :2020-11-23
--Author : generated by FairyGUI
--Desc : 

local DreamMasterPvpGuessView,Super = class("DreamMasterPvpGuessView", Window)

function DreamMasterPvpGuessView:ctor()
	--LuaLog("DreamMasterPvpGuessView ctor")
	self._packName = "DreamMasterPvp"
	self._compName = "DreamMasterPvpGuessView"
	self._rootDepth = LayerDepth.PopWindow
	
end

function DreamMasterPvpGuessView:_initEvent( )
	self.btn_add:addClickListener(function()
		local addNum = 1
		addNum = addNum + self.slider:getValue()
		if addNum > self.maxNum then
			addNum = self.maxNum
		end
		self.slider.num1:setText(Desc.DreamMasterPvp_guess1:format(addNum))
		self.slider:setValue(addNum)
	end,33)
	
	self.btn_back:addClickListener(function()
		local addNum = 1
		addNum = self.slider:getValue() - addNum
		if addNum < 0 then
			addNum = 0
		end
		self.slider.num1:setText(Desc.DreamMasterPvp_guess1:format(addNum))
		self.slider:setValue(addNum)
	end,33)

	self.btn_cancel:addClickListener(function()
		self:closeView()
	end,33)
	
	self.btn_ok:addClickListener(function()
		if self.slider:getValue() <=0 then
			RollTips.show(Desc.DreamMasterPvp_nojifen)
		 	return 
		end
		DreamMasterPvpModel:GuessReq(self._args.guessPos,self.slider:getValue())
		self:closeView()
	end,33)
end

function DreamMasterPvpGuessView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:DreamMasterPvp.DreamMasterPvpGuessView
	self.btn_add = viewNode:getChildAutoType('$btn_add')--GButton
	self.btn_back = viewNode:getChildAutoType('$btn_back')--GButton
	self.blackbg = viewNode:getChildAutoType('blackbg')--GLabel
	self.btn_cancel = viewNode:getChildAutoType('btn_cancel')--GButton
	self.btn_ok = viewNode:getChildAutoType('btn_ok')--GButton
	self.frame = viewNode:getChildAutoType('frame')--GLabel
	self.guessTxt = viewNode:getChildAutoType('guessTxt')--GRichTextField
	self.slider = viewNode:getChildAutoType('slider')--Slider2
		self.slider.num1 = viewNode:getChildAutoType('slider/num1')--GRichTextField
		self.slider.num2 = viewNode:getChildAutoType('slider/num2')--GRichTextField
	--{autoFieldsEnd}:DreamMasterPvp.DreamMasterPvpGuessView
	--Do not modify above code-------------
end

function DreamMasterPvpGuessView:_initUI( )
	self:_initVM()

	self.maxNum = DynamicConfigData.t_DreamMasterPvpConst[1].guessLimit
	local myScore = DreamMasterPvpModel.myGuessInfo and DreamMasterPvpModel.myGuessInfo.dreamPvpScore or 0
	if myScore < self.maxNum then
		self.maxNum = myScore
	end
	local function onChanged( ... )
    	local value = math.ceil(self.slider:getValue()/100*self.maxNum)
    	if value<=1 then value = 1 end
    	
    	self.slider.num1:setText(Desc.DreamMasterPvp_guess1:format(self.slider:getValue()))
	end

	self.slider.num1:setText(Desc.DreamMasterPvp_guess1:format(0))
	self.slider.num2:setText(Desc.DreamMasterPvp_guess2:format(self.maxNum))
	self.slider:setMax(self.maxNum)
	self.slider:setValue(0)
	self.slider:addEventListener(FUIEventType.Changed, onChanged);

	self.guessTxt:setText(Desc.DreamMasterPvp_guessTxt:format(myScore,self._args.guessName))
end




return DreamMasterPvpGuessView