--Date :2021-01-02
--Author : generated by FairyGUI
--Desc : 

local TrialActivityController = class("TrialActivity",Controller)

function TrialActivityController:init()
	self.isSend = false
	self.result = false
end

function TrialActivityController:Activity_UpdateData(_, params)
	if params.type == GameDef.ActivityType.Trial then
        TrialActivityModel:initTrialData(params.trial)
       -- Dispatcher.dispatchEvent("TrialActivity_refreshPanal")
    elseif  params.type == GameDef.ActivityType.TrialShop then
        TrialActivityModel:initTrialShopData(params.trialShop)
    end

end



function TrialActivityController:trialActivity_battle( _,eventData )
	
	local function battleHandler(eventName,args)
		if eventName == "begin" then
			if self.isSend then RollTips.show(Desc.common_networktips) return  end
			self.isSend = true
			local params = {}
			params.activityId = TrialActivityModel:getActivityId()

			printTable(33,"send Activity_Trial_OnBattle",params)
			RPCReq.Activity_Trial_OnBattle(params,function(data)
					printTable(33,"Activity_Trial_OnBattle call",data)
					local result = {}
					result.isWin = data.win
					result.reward = data.rewards
					result.type = GameDef.GamePlayType.ActivityTrial
					ModelManager.PlayerModel:set_awardData(result)
					TrialActivityModel.match = false
					--TrialActivityModel.restTimes = TrialActivityModel.restTimes - 1
					self.isSend = false
					self.result = result
				end,function (errorData)
					RollTips.showError(errorData)
					self.isSend = false
				end)
		elseif eventName == "next" then
            --Dispatcher.dispatchEvent(EventType.battle_end,args)
        elseif (eventName == "end") then
			--ViewManager.open("ReWardView",{page=4,type=1,data=self.result,isWin=self.result.isWin})
			Dispatcher.dispatchEvent(EventType.trialActivity_exchangeSuccess)
		end
	end

	
	print(33,"trialActivity_battle dispatchEvent.battle_requestFunc")
    Dispatcher.dispatchEvent(EventType.battle_requestFunc,battleHandler,
    {serverId = eventData.serverId,playerId = eventData.playerId,heroNum = TrialActivityModel.heroNum,fightID=TrialActivityModel.fightId,configType=GameDef.BattleArrayType.Trail})
	
end

return TrialActivityController