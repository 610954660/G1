--Date :2021-01-02
--Author : generated by FairyGUI
--Desc : 

local TrialActivityBattleView,Super = class("TrialActivityBattleView", View)

function TrialActivityBattleView:ctor()
	--LuaLog("TrialActivityBattleView ctor")
	self._packName = "TrialActivity"
	self._compName = "TrialActivityBattleView"
	--self._rootDepth = LayerDepth.Window
	
end

function TrialActivityBattleView:_initEvent( )
	
end

function TrialActivityBattleView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:TrialActivity.TrialActivityBattleView
	self.c1 = viewNode:getController('c1')--Controller
	self.list = viewNode:getChildAutoType('list')--GList
	--{autoFieldsEnd}:TrialActivity.TrialActivityBattleView
	--Do not modify above code-------------
end

function TrialActivityBattleView:_initListener( )
	local config = DynamicConfigData.t_TrialAwardNum
	self.list:setItemRenderer(function(index, obj)
		local data = self.list._dataTemplate[index+1]
		local rewards = config[data.category].rewards
		local url = ItemConfiger.getItemIconByCode(rewards[1].code, rewards[1].type, false)
		obj:setIcon(url)
		obj:setTitle("x"..(rewards[1].amount*data.num))
		end)
end

function TrialActivityBattleView:_initUI( )
	self:_initVM()
	self:_initListener()
	self.cagorageBg = self._parentWin.view:getChildAutoType("cagorage")
end


function TrialActivityBattleView:trialActivity_updateArry( )
	local heroCodeList = {}
	local showList = {}
	local Array = BattleModel.__requestArrayInfos[GameDef.BattleArrayType.Trail]
	for k, v in pairs(Array) do
		local hero=ModelManager.BattleModel:getHeroByUid(v.uuid)
		if not heroCodeList[hero.category] then
			local t = {category = hero.category,num = 0}
			heroCodeList[hero.category] = t
			table.insert(showList,t)
		end
		heroCodeList[hero.category].num = heroCodeList[hero.category].num + 1
	end
	local num = #showList
	if  num > 0 then
		TableUtil.sortByMap(showList,{{key = "category", asc = false}})
		self.c1:setSelectedIndex(1)
		self.list:setData(showList)
		self.cagorageBg:setWidth(790+num*50)
	else
		self.c1:setSelectedIndex(0)
		self.cagorageBg:setWidth(1050)
	end

	
	
end

return TrialActivityBattleView