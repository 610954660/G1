--Name : SecretWeaponsGetView.lua
--Author : generated by FairyGUI
--Date : 2020-7-28
--Desc : 秘武激活界面

local SecretWeaponsGetView,Super = class("SecretWeaponsGetView", Window)

function SecretWeaponsGetView:ctor()
	--LuaLog("SecretWeaponsGetView ctor")
	self._packName = "SecretWeapons"
	self._compName = "SecretWeaponsGetView"
	self._rootDepth = LayerDepth.FaceWindow
	self.curId=1
end

function SecretWeaponsGetView:_initEvent( )
	
end

function SecretWeaponsGetView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:SecretWeapons.SecretWeaponsGetView
		vmRoot.img_equip = viewNode:getChildAutoType("$img_equip")--loader
		vmRoot.list_attr = viewNode:getChildAutoType("$list_attr")--list
		vmRoot.skillCel = viewNode:getChildAutoType("$skillCel")--Button
		vmRoot.img_bg = viewNode:getChildAutoType("$img_bg")--loader
		vmRoot.txt_skillDesc = viewNode:getChildAutoType("$txt_skillDesc")--richtext
		vmRoot.txt_name = viewNode:getChildAutoType("$txt_name")--richtext
		vmRoot.txt_skillName = viewNode:getChildAutoType("$txt_skillName")--richtext
	--{vmFieldsEnd}:SecretWeapons.SecretWeaponsGetView
	--Do not modify above code-------------
end

function SecretWeaponsGetView:_initUI( )
	self:_initVM()
	local imgbg=SecretWeaponsModel:getSecretWeaponsGetbg()
	self.img_bg:setURL(imgbg)
	self.curId=self._args.id
	local equipurl = SecretWeaponsModel:getEquipById(self.curId)
	self.img_equip:setURL(equipurl)
	local con=DynamicConfigData.t_godArmsTrigger[self.curId]
	self.txt_name:setText(con.name)
	local lv= SecretWeaponsModel:getEquipSkillLv(self.curId)
	local ConfigSkill=DynamicConfigData.t_godArms
	local configOd= ConfigSkill[self.curId]
	if not configOd[lv] then
		return
	end
	local skillId=configOd[lv].skillId
	local conf = DynamicConfigData.t_skill[skillId];
	local cell = BindManager.bindSkillCell(self.skillCel)
	cell:setData(skillId)
	self.skillCel:removeClickListener(100);
	self.skillCel:addClickListener(function ()
		if conf then
			ViewManager.open("ItemTips", {codeType = CodeType.SKILL, id = skillId,data = conf})
		end
	end,100)
	self.txt_skillName:setText(conf.skillName)
	self.txt_skillDesc:setText(conf.showName)

	local attMap= configOd[lv].addAttr
	self.list_attr:setItemRenderer(
		function(index, obj)
		local itemAttr=attMap[index+1]
		local attrName= GMethodUtil:getFightAttrName(itemAttr.type)
		local attrNum=	GMethodUtil:getFightAttrName(itemAttr.type,itemAttr.value)
		local txt_attrName= obj:getChildAutoType("txt_attrName")	
		txt_attrName:setText(attrName)
		local txt_cur= obj:getChildAutoType("txt_cur")	
		txt_cur:setText(attrNum)
		local iconLoader = obj:getChildAutoType("loader_attrIcon")
		iconLoader:setURL(PathConfiger.getFightAttrIcon(itemAttr.type))
        end
    )
    self.list_attr:setNumItems(#attMap)
end




return SecretWeaponsGetView