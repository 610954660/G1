--Name : SecretWeaponPromoteView.lua
--Author : generated by FairyGUI
--Date : 2020-7-28
--Desc : 秘武提升

local SecretWeaponPromoteView,Super = class("SecretWeaponPromoteView", Window)

function SecretWeaponPromoteView:ctor()
	--LuaLog("SecretWeaponPromoteView ctor")
	self._packName = "SecretWeapons"
	self._compName = "SecretWeaponPromoteView"
	self._rootDepth = LayerDepth.PopWindow
	
end

function SecretWeaponPromoteView:_initEvent( )
	
end

function SecretWeaponPromoteView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:SecretWeapons.SecretWeaponPromoteView
		vmRoot.list_attr = viewNode:getChildAutoType("$list_attr")--list
		vmRoot.itemCell = viewNode:getChildAutoType("$itemCell")--Button
		vmRoot.btn_use = viewNode:getChildAutoType("$btn_use")--Button
		vmRoot.bar_exp = viewNode:getChildAutoType("$bar_exp")--ProgressBar
	--{vmFieldsEnd}:SecretWeapons.SecretWeaponPromoteView
	--Do not modify above code-------------
end

function SecretWeaponPromoteView:_initUI( )
	self:_initVM()
    self.c1 = self.view:getController("c1")
	self:showInfo()
end

function SecretWeaponPromoteView:showInfo( )
	local configInfo=DynamicConfigData.t_godArmsCost
	local cost=configInfo[3].cost
	local maxLimit=configInfo[3].param
	local itemcell = BindManager.bindItemCell(self.itemCell)
	local award = cost[1]
	itemcell:setData(award.code, award.amount, award.type)
	local hasNum = ModelManager.PackModel:getItemsFromAllPackByCode(award.code)
	itemcell:setAmount(hasNum)
	local count= SecretWeaponsModel:getAscendingnumber()
	self.bar_exp:setMax(maxLimit)
	self.bar_exp:setValue(count)
	if maxLimit==count then
		self.c1:setSelectedIndex(2)
	else
		self.c1:setSelectedIndex(1)
	end
	local attMap=configInfo[3].addAttr
	self.list_attr:setItemRenderer(
		function(index, obj)
		local itemAttr=attMap[index+1]
		local attrName= GMethodUtil:getFightAttrName(itemAttr.type)
		local attrNum=	GMethodUtil:getFightAttrName(itemAttr.type,itemAttr.value*count)
		local c1= obj:getController("c1")	
		c1:setSelectedIndex(1)
		local txt_attrName= obj:getChildAutoType("txt_attrName")	
		txt_attrName:setText(attrName)
		local txt_cur= obj:getChildAutoType("txt_cur")	
		txt_cur:setText(attrNum)
		local iconLoader = obj:getChildAutoType("loader_attrIcon")
		iconLoader:setURL(PathConfiger.getFightAttrIcon(itemAttr.type))
        end
    )
    self.list_attr:setNumItems(#attMap)
end

function SecretWeaponPromoteView:_initEvent( )
	self.btn_use:addClickListener(
        function(context)
			SecretWeaponsModel:godArmsUpCount()
        end
    )
end

function SecretWeaponPromoteView:secretWeapons_Lianhua( )
	self:showInfo()
end



return SecretWeaponPromoteView