--Name : EquipmentSkillView.lua
--Author : generated by FairyGUI
--Date : 2020-7-13
--Desc : 

local EquipmentSkillView,Super = class("EquipmentSkillView", View)

function EquipmentSkillView:ctor()
	--LuaLog("EquipmentSkillView ctor")
	self._packName = "Equipment"
	self._compName = "EquipmentSkillView"
	self._rootDepth = LayerDepth.PopWindow
	
end

function EquipmentSkillView:_initEvent( )
	
end

function EquipmentSkillView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:Equipment.EquipmentSkillView
		vmRoot.xinyuanTxt = viewNode:getChildAutoType("$xinyuanTxt")--text
		vmRoot.btn_cancel = viewNode:getChildAutoType("$btn_cancel")--Button
		vmRoot.oldskill = viewNode:getChildAutoType("$oldskill")--list
		vmRoot.newskill = viewNode:getChildAutoType("$newskill")--list
		vmRoot.btn_change = viewNode:getChildAutoType("$btn_change")--Button
	--{vmFieldsEnd}:Equipment.EquipmentSkillView
	--Do not modify above code-------------
end

function EquipmentSkillView:_initUI( )
	self:_initVM()
	
	self.xinyuanTxt:setText(Desc.equipment_xinyuan..self._args.curX.."/")
	
	local config = self._args.data.list[1]
	
	
	
	if config.skill and #config.skill > 0 then
		
		self.oldskill:setItemRenderer(function(index,obj)
				local skillCell = BindManager.bindSkillCell(obj:getChildAutoType("skillCell"))
				skillCell:setEquipmentData(config.skill[index+1],1)
				local conf = EquipmentModel:getSkillConfigByCode(config.skill[index+1])
				obj:getChildAutoType("title"):setText(conf.skillName)
				obj:getChildAutoType("desc"):setText(conf.skillDesc)
			end)
		self.oldskill:setNumItems(#config.skill)
	end
	
	if config.showSkill and #config.showSkill > 0 then

		self.newskill:setItemRenderer(function(index,obj)
				local skillCell = BindManager.bindSkillCell(obj:getChildAutoType("skillCell"))
				skillCell:setEquipmentData(config.showSkill[index+1],1)
				local conf = EquipmentModel:getSkillConfigByCode(config.showSkill[index+1])
				obj:getChildAutoType("title"):setText(conf.skillName)
				obj:getChildAutoType("desc"):setText(conf.skillDesc)
			end)
		self.newskill:setNumItems(#config.showSkill)
	end
	
	
	self.btn_cancel:addClickListener(function( ... )
			self:closeView()
		end)
	self.btn_change:addClickListener(function( ... )


			RPCReq.Equipment_SaveRecasting(self._args.info,function(args)
				printTable(33,"Equipment_SaveRecasting callback",args)
					
					
					EquipmentModel:setSkillData(args.list[1].uuid,args.list[1])
					local newScore = EquipmentModel:calcCombat(args.list[1])
					print(33,"Equipment_SaveRecasting upupuup",newScore,self._args.eqData.score)
					if self._args.eqData.w then
						RollTips.showAddFightPoint(newScore-self._args.eqData.score)
						self._args.eqData.score = newScore
					end
					
				--setRightArea1( t_eqInfo,t_eqData )
				--updateSkillData(t_eqInfo,t_eqData)
				Dispatcher.dispatchEvent(EventType.equipment_refresheq)
				RollTips.show(Desc.equipment_save)
				self:closeView()
			end)
		end)
end




return EquipmentSkillView