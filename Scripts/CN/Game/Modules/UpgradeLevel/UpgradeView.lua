--Name : UpgradeView.lua
--Author : generated by FairyGUI
--Date : 2020-3-20
--Desc : 

local UpgradeView,Super = class("UpgradeView", View)

function UpgradeView:ctor()
	--LuaLog("UpgradeView ctor")
	self._packName = "UpgradeLevel"
	self._compName = "UpgradeView"
	self._rootDepth = LayerDepth.PopWindow
	self._isFullScreen = true
	
	
	self.curData = false
	self.nextData = false
end

function UpgradeView:_initEvent( )
	
end

function UpgradeView:_initVM( )
	local vmRoot = self
	local viewNode = self.view
	---Do not modify following code--------
	--{vmFields}:UpgradeLevel.UpgradeView
		vmRoot.mask = viewNode:getChildAutoType("$mask")--graph
		vmRoot.mditem = viewNode:getChildAutoType("$mditem")--
		vmRoot.cur = viewNode:getChildAutoType("$cur")--text
		vmRoot.before = viewNode:getChildAutoType("$before")--text
	--{vmFieldsEnd}:UpgradeLevel.UpgradeView
	--Do not modify above code-------------
end

function UpgradeView:_initUI( )
	self:_initVM()
	
	local spineParentDown = self.view:getChildAutoType("spineParentDown")
	local spineParentUp = self.view:getChildAutoType("spineParentUp")
	local spineDown =  SpineUtil.createSpineObj(spineParentDown, vertex2(spineParentDown:getWidth()/2,spineParentDown:getHeight()/2), "gongnengjiesuo_down", "Spine/ui/jiesuan", "efx_gongnengjiesuo", "efx_gongnengjiesuo",true)
	local spineUp =  SpineUtil.createSpineObj(spineParentUp, vertex2(spineParentUp:getWidth()/2,spineParentUp:getHeight()/2), "gongnengjiesuo_up", "Spine/ui/jiesuan", "efx_gongnengjiesuo", "efx_gongnengjiesuo",true)
    spineDown:setCompleteListener(function( name )
    	--spine1:setAnimation(0,"gongnengjiesuo_up",true)
    end)
	self.mask:addClickListener(function()
		if self.curData then
			self.view:getTransition("out"):play(function()
						self:closeViewNextFrame()
				end);
		else
			self:closeView()
		end	
	end)
	
	self.cur:setText(self._args.curLevel)
	self.before:setText(self._args.beLevel)
	
	--local config = DynamicConfigData.t_modulePre
	
	
	
	local nextData,nextLv = ModuleUtil.getNextModuleOpenInfo(self._args.curLevel)
		
	if nextData then
		local icon = self.mditem:getChildAutoType("icon")
		local level = self.mditem:getChildAutoType("level")
		local desc = self.mditem:getChildAutoType("desc")
		local title = self.mditem:getChildAutoType("title")
	
		icon:setURL(PathConfiger.getModuleIcon(nextData.picture))
		level:setText(ModuleUtil.getModuleOpenTips(nextData.moduleId)..Desc.upgrade_unlock)
		desc:setText(nextData.desc)
		title:setText(nextData.name)
	else
		self.mditem:setVisible(false)
	end
	
	self.view:getTransition("enter"):play(function()

		end);
end


function UpgradeView:_exit()
	Dispatcher.dispatchEvent(EventType.player_levelUp)
	--[[if self.curData then
		PHPUtil.reportStep(ReportStepType.GET_MODULE_OPEN+self.curData.id)
		ViewManager.open("ModuleOpenView",self.curData)
	end--]]
	Scheduler.scheduleNextFrame(function()
		Dispatcher.dispatchEvent(EventType.module_open_hint)
		LoginSendModel:upDateInfo()
	end)
				
	
end
return UpgradeView