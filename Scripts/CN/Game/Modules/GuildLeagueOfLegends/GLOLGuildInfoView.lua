--Date :2021-01-15
--Author : generated by FairyGUI
--Desc : 

local GLOLGuildInfoView,Super = class("GLOLGuildInfoView", Window)

function GLOLGuildInfoView:ctor()
	--LuaLog("GLOLGuildInfoView ctor")
	self._packName = "GuildLeagueOfLegends"
	self._compName = "GLOLGuildInfoView"
	self._rootDepth = LayerDepth.PopWindow
	self.data = self._args.data
end

function GLOLGuildInfoView:_initEvent( )
	
end

function GLOLGuildInfoView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:GuildLeagueOfLegends.GLOLGuildInfoView
	self.blackbg = viewNode:getChildAutoType('blackbg')--GLabel
	self.frame = viewNode:getChildAutoType('frame')--GLabel
	self.guildIcon = viewNode:getChildAutoType('guildIcon')--GLoader
	self.list_player = viewNode:getChildAutoType('list_player')--GList
	self.txt_combat = viewNode:getChildAutoType('txt_combat')--GTextField
	self.txt_guildName = viewNode:getChildAutoType('txt_guildName')--GTextField
	self.txt_guildStr = viewNode:getChildAutoType('txt_guildStr')--GTextField
	self.txt_lv = viewNode:getChildAutoType('txt_lv')--GTextField
	self.txt_playerCount = viewNode:getChildAutoType('txt_playerCount')--GTextField
	self.txt_rank = viewNode:getChildAutoType('txt_rank')--GTextField
	self.txt_score = viewNode:getChildAutoType('txt_score')--GTextField
	--{autoFieldsEnd}:GuildLeagueOfLegends.GLOLGuildInfoView
	--Do not modify above code-------------
end

function GLOLGuildInfoView:_initUI( )
	self:_initVM()
	GuildLeagueOfLegendsModel:reqGuildInfo(self.data.guildId, self.data.serverId);
end

function GLOLGuildInfoView:GLOL_findGuildInfo(_, guildInfo)
	if (guildInfo.id == self.data.guildId) then
		self:upView(guildInfo);
	end
end

function GLOLGuildInfoView:upView(guildInfo)
	self.guildIcon:setIcon(GuildModel:getGuildHead(guildInfo.icon));
	self.txt_guildName:setText(guildInfo.name);
	self.txt_lv:setText(guildInfo.level);
	local score = self.data.value or 0;
	local rank = GuildLeagueModel:getRankByScore(score) or 0
	local conf = DynamicConfigData.t_GLRank[rank] or DynamicConfigData.t_GLRank[0];
	self.txt_rank:setText(conf.rank); -- 段位
	self.txt_score:setText(score); -- 星数
	self.txt_guildStr:setText(guildInfo.announcement);
	-- 人数
	local max = DynamicConfigData.t_guildLevel[guildInfo.level].limitNum
	self.txt_playerCount:setText(string.format(Desc.GLOL_str13, TableUtil.GetTableLen(guildInfo.memberMap), max));
	-- 战力
	local combat = 0;
	local list = {};
	for _, playInfo in pairs(guildInfo.memberMap) do
		combat = combat + playInfo.combat;
		table.insert(list, playInfo);
	end
	TableUtil.sortByMap(list, {{key = "position", asc = false}, {key = "combat", asc = true}});
	self.txt_combat:setText(StringUtil.transValue(combat))
	self.list_player:setItemRenderer(function (idx, obj)
		local info = list[idx + 1];
		local playerCell = obj:getChildAutoType("heroCell")
		if (not obj.cell) then
			obj.cell = BindManager.bindPlayerCell(playerCell);
		end
		obj.cell:setHead(info.icon, info.level, nil, nil, info.headBorder);
		obj:getChildAutoType("txt_name"):setText(info.name);
		obj:getChildAutoType("txt_combat"):setText(StringUtil.transValue(info.combat));
		obj:getChildAutoType("txt_lv"):setText(Desc["GLOL_guessRewardLv"..info.position]);
		playerCell:removeClickListener();
		playerCell:addClickListener(function()
			ViewManager.open("ViewPlayerView",{playerId = info.playerId, serverId = info.serverId, hideBtns = true})
		end);
	end)
	self.list_player:setNumItems(#list);
end


return GLOLGuildInfoView