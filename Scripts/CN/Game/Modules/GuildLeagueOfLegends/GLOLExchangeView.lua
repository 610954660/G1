--Date :2021-01-09
--Author : generated by FairyGUI
--Desc : 

local GLOLExchangeView,Super = class("GLOLExchangeView", Window)

function GLOLExchangeView:ctor()
	--LuaLog("GLOLExchangeView ctor")
	self._packName = "GuildLeagueOfLegends"
	self._compName = "GLOLExchangeView"
	self._rootDepth = LayerDepth.PopWindow
	self.num = 1;
end

function GLOLExchangeView:_initEvent( )
	
end

function GLOLExchangeView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:GuildLeagueOfLegends.GLOLExchangeView
	self.btn_add = viewNode:getChildAutoType('btn_add')--GButton
	self.btn_sub = viewNode:getChildAutoType('btn_sub')--GButton
	self.buy = viewNode:getChildAutoType('buy')--GButton
	self.cancel = viewNode:getChildAutoType('cancel')--GButton
	self.frame = viewNode:getChildAutoType('frame')--GLabel
	self.itemCell = viewNode:getChildAutoType('itemCell')--GButton
	self.mark = viewNode:getChildAutoType('mark')--GLabel
	self.txt_input = viewNode:getChildAutoType('txt_input')--GTextField
	self.txt_value = viewNode:getChildAutoType('txt_value')--GRichTextField
	--{autoFieldsEnd}:GuildLeagueOfLegends.GLOLExchangeView
	--Do not modify above code-------------
end

function GLOLExchangeView:_initListener( )
	
	self.btn_add:addClickListener(function()
		self.num = self.num + 1;
		self:upInfo();
	end)

	self.btn_sub:addClickListener(function()
		self.num = math.max(self.num - 1, 1);
		self:upInfo();
	end)

	self.buy:addClickListener(function()
		local conf = DynamicConfigData.t_GLConst[1];
		local exchange = conf.legendCoinChange[1]
		local num = exchange.amount * self.num;
		local cost = {
			code = exchange.code,
			amount = num,
			type = exchange.type
		}
		if PlayerModel:checkCostEnough(cost, true) then
			GuildLeagueOfLegendsModel:exchangeCoin(self.num);
		end
	end)

	self.cancel:addClickListener(function()
		self:closeView();
	end)
	local conf = DynamicConfigData.t_GLConst[1];
	local item = conf.legendLuckDraw[1]
	self.itemCell = BindManager.bindItemCell(self.itemCell);
	self.itemCell:setData(item.code, item.amount, item.type);
end

function GLOLExchangeView:_initUI( )
	self:_initVM()
	self:_initListener()
	self:upInfo();
end

function GLOLExchangeView:upInfo()
	local conf = DynamicConfigData.t_GLConst[1];
	local exchange = conf.legendCoinChange[1]
	local num = exchange.amount * self.num;
	self.txt_input:setText(self.num);
	self.txt_value:setText(string.format(Desc.GLOL_exchangeStr, Desc.GL_coin, num));
end


return GLOLExchangeView