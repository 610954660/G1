--Date :2020-12-31
--Author : generated by FairyGUI
--Desc : 

local GLLegendsBetView,Super = class("GLLegendsBetView", Window)

function GLLegendsBetView:ctor()
	--LuaLog("GLLegendsBetView ctor")
	self._packName = "GuildLeagueOfLegends"
	self._compName = "GLLegendsBetView"
	self._rootDepth = LayerDepth.PopWindow
	self.side = self._args.side or 1;
end

function GLLegendsBetView:_initEvent( )
	
end

function GLLegendsBetView:_initVM( )
	local viewNode = self.view
	---Do not modify following code--------
	--{autoFields}:GuildLeagueOfLegends.GLLegendsBetView
	self.blackbg = viewNode:getChildAutoType('blackbg')--GLabel
	self.btn_sure = viewNode:getChildAutoType('btn_sure')--GButton
	self.frame = viewNode:getChildAutoType('frame')--GLabel
	self.list_item = viewNode:getChildAutoType('list_item')--GList
	self.txt_num = viewNode:getChildAutoType('txt_num')--GRichTextField
	self.txt_title = viewNode:getChildAutoType('txt_title')--GRichTextField
	--{autoFieldsEnd}:GuildLeagueOfLegends.GLLegendsBetView
	--Do not modify above code-------------
end

function GLLegendsBetView:_initListener( )
	
	self.btn_sure:addClickListener(function()
		local s = self.list_item:getSelectedIndex() + 1
		local select = s == 0 and false or s;
		GuildLeagueOfLegendsModel:guess(self.side, select)
		self:closeView();
	end)

	local conf = DynamicConfigData.t_GLConst[1];
	local coins = conf.legendGuessAddCoin
	local rate = conf.exchangeRatio
	local base = conf.legendGuessCoin[1]
	self.list_item:setItemRenderer(function(index, obj)
		local d = coins[index + 1];
		if (not obj.item) then
			obj.item = BindManager.bindItemCell(obj:getChildAutoType("itemCell"));
		end
		if (not obj.cost) then
			obj.cost = BindManager.bindCostItem(obj:getChildAutoType("costItem"));
			obj.cost:setDarkBg(true);
			obj.cost.iconLoader:setScale(0.7, 0.7);
		end
		obj.item:setData(base.code, rate * d.amount, base.type);
		obj.cost:setData(d.type, d.code, d.amount, true);
		local btn = obj:getChildAutoType("btn_check");
		obj:removeClickListener()
		obj:addClickListener(function()
			local selected = self.list_item:getSelectedIndex();
			if (selected ~= index) then
				if (PlayerModel:checkCostEnough(d)) then
					self.list_item:setSelectedIndex(index);
				else
					RollTips.show(Desc.GLOL_str5);
				end
			else
				self.list_item:setSelectedIndex(-1);
			end
			self:upSelectNum();
		end)
	end)
	self.list_item:setNumItems(#coins)
end

function GLLegendsBetView:_initUI( )
	self:_initVM()
	self:_initListener()
	self:upSelectNum();
end

function GLLegendsBetView:upSelectNum()
	local conf = DynamicConfigData.t_GLConst[1];
	local coins = conf.legendGuessAddCoin
	local rate = conf.exchangeRatio
	local base = conf.legendGuessCoin[1].amount
	local select = self.list_item:getSelectedIndex();
	if (coins[select + 1]) then
		base = base + coins[select + 1].amount * rate;
	end
	self.txt_num:setText(string.format(Desc.GLOL_str6, base));
end


return GLLegendsBetView